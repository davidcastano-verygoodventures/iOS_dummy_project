default_platform(:ios)

platform :ios do
  desc "Run Pipeline"
  lane :pr_check do
    ENV['DEVELOPER_DIR'] = ENV['DEVELOPER_DIR'] || '/Applications/Xcode.app/Contents/Developer'
    swiftlint(mode: :lint, config_file: ".swiftlint.yml")
    
    if ENV['SONAR_HOST_URL'] && !ENV['SONAR_HOST_URL'].empty?
        sonar(
           project_key: "PipelineTest",
           project_name: "PipelineTest",
           project_version: "1.0",
           sources_path: "dummyProject",
           sonar_runner_args: "-Dsonar.host.url=#{ENV['SONAR_HOST_URL']} -Dsonar.login=#{ENV['SONAR_LOGIN'] || 'admin'} -Dsonar.password=#{ENV['SONAR_PASSWORD'] || 'admin123'}"
        )
    else
        UI.message("⚠️  Skipping SonarQube analysis: SONAR_HOST_URL not set")
    end

    run_tests(
      project: "dummyProject/dummyProject.xcodeproj",
      scheme: "dummyProject",
      device: "iPhone 15",
      clean: true
    )
  end
end
